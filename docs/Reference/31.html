<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>ステージエディター|リファレンス</title>
    <link rel="stylesheet" href="../css/ReferenceStyle.css">
</head>
<body>
    <header>
        <h1>ステージエディター</h1>
    </header>
    <main>
        <h1>概要説明</h1>   
        <!-- 概要説明 -->
        <div id = OverView>
            <h2>1:ステージエディターを作成した理由</h2>
            <p>今回の制作では、複数のステージを効率的に作成しなければならなかっため、ステージエディターを作成するようになりました。<br>
            しかし、一から3Dゲーム用マップエディタを作成するのは、開発期間と工数の関係上現実的ではなかったため、UnityEditorを拡張することでステージエディターを作成する運びとなりました。<br>
            ステージエディターの仕様としては、まずUnity側でステージ配置・アクション設定・イベント設定・その他付随する設定等を行い、それをXML形式で書き出してゲームデータ側では、出力されたXMLファイルを読込それに基づいて、配置・イベント等の設定を行います。そうすることによって、Unity側で作ったステージをそのままゲームステージとして使えるため、大幅な作業コストの削減を実現する事ができます。
            </p>

            <h2>2:仕様</h2>
            <div class="Specification">
                <h3>①パラメータ設定</h3>
                <h4>1,基本設定</h4>
                <div class="flex">
                <img src="../img/StageEditorParam.png" alt="パラメータ設定画像">
                <dl class = "ParamBox" id="DefaultSet">
                    <dt><strong>・基本設定値</strong></dt>
                    <dd>
                        <dl>
                            <dt>生成順序</dt>
                            <dd>Early・Default・Lateの三つから生成順序を設定する。設定した順序に応じてGame側では、生成される。</dd>
                            <dt>クラスタイプ</dt>
                            <dd>Game側でのクラス識別に使用される。識別登録をGame側でもしなければいけない。</dd>
                            <dt>メッシュキー</dt>
                            <dd>Game側で登録されているメッシュキーを設定する。登録されてないキーを指定すると実行時エラーが発生する。</dd>
                            <dt>テクスチャキー</dt>
                            <dd>Game側で登録されているテクスチャキーを設定する。登録されていないキーを設定すると白い状態で描画される。</dd>
                            <dt>タグ情報</dt>
                            <dd>Game側での、オブジェクトの識別タグとして使用する。複数指定ができるので、オブジェクト同士の共通処理等に使用できる。</dd>
                        </dl>
                    </dd>
                    <dt><strong>・物理設定</strong></dt>
                    <dd>
                        <dl>
                            <dt>物理設定を有効にする</dt>
                            <dd>コリジョンを有効にする。無効化すると、当たり判定がなくなるため、オブジェクトがすり抜ける。</dd>
                            <dt>固定オブジェクト化</dt>
                            <dd>オブジェクトの当たり判定を固定化にする、固定化するとそのオブジェクトの衝突応答が呼ばれなくなる。</dd>
                        </dl>
                    </dd>
                    <dt><strong>・共有設定</strong></dt>
                    <dd>
                        <dl>
                            <dt>書き出し有効</dt>
                            <dd>常に追従する必要のあるプレイヤーやゴールなどをアクセスしやすいように、共有領域に保存を有効にする。</dd>
                            <dt>共有キー</dt>
                            <dd>共有設定が有効の時に、ここで指定した、共有キーでオブジェクトを共有領域に保存する。もしオブジェクトを共有領域から参照する場合は、ここで登録した共有キーを用いて共有領域から参照する。</dd>
                        </dl>
                    </dd>
                    <dt><strong>・イベント設定</strong></dt>
                    <dd>
                        <dl>
                            <dt>イベント受信可能</dt>
                            <dd>スイッチイベント等を受け取る場合、この設定を有効にする。</dd>
                            <dt>イベント受信キー</dt>
                            <dd>受信可能の場合、ここで指定した受信キーでイベントレシーバー登録される。スイッチ側では、ここで指定した受信キーをイベント送信先に設定された場合、イベントが発生した時にオブジェクトイベントが送信される。</dd>
                        </dl>
                    </dd>
                </dl>
                </div>
                <p>
                    ここでは、配置データの他に追加で読み込む必要があるデータをセットします。配置データは、Unityのオブジェクトに付随するTransformから取得します。配置データの他には、Game側で登録したメッシュキーや、テクスチャキーなどがあります。この二つのキーは、Game側で予めキーとリソースを登録しておく必要があります。リソースの登録については、<a href="33.html" target="_blank">リソースマップエディタ</a>を参照してください。<br><br>
                    次に、物理設定の項目についてですが、Game側で記述した衝突応答などの物理処理は、この項目で物理判定を有効にしないと呼ばれません。例えば、プレイヤー側で敵にぶつかったらHPを減らす処理を実装していたとします。もし物理判定が無効化されていた場合、プレイヤーには判定がついていないため、HPが減らないどころか地面もすり抜けてしまいます。そして次に、オブジェクト固定化設定ですが、こちらを有効にすると自分の衝突応答は呼ばれませんが、衝突した相手の衝突応答処理は、呼ばれるので、例えば特定の地面との接地判定をしたいときに、地面側の判定は余計なので、固定化に設定するということができます。<br>
                    最後に、イベント設定についてですが、Game側で使用されるスイッチイベントは、スイッチと対象オブジェクトの接続設定しないと動作しません。BaseCross64では、ゲームシーンの切り替えにEventという構造体をオブジェクト同士が送受信することで切り替えを行っています。Eventの送信方法は、SendとPostの二種類があって、まずSendは、描画等の全体更新を待たずに直接対象に送る方式で、Postの方は、DispatchTimeを指定し、その時間イベントを一時的に保持して、全体更新後に送信する方式になります。イベント設定で指定された受信キーは、Game側でイベントの受信元として設定しておく必要があります。そして、イベントの送信に際して、指定した受信先にスイッチ設定で設定したイベントメッセージが送られ、それに応じて処理を分けることによってスイッチイベントを簡単に作成することができます。
                </p>
                <h4>2,アクション設定</h4>
                <div class="flex">
                <img src="../img/Actions.png" alt="パラメータ設定画像">
                <dl class = "ParamBox" id ="ActionTab">
                    <dt><strong>再生タイミング</strong></dt>
                    <dd>Start・OnEvent・Endの三項目から設定する。Start・Endに設定すると、Game開始時と終了時に呼ばれるアクションを指定できる。OnEventに設定すると、スイッチ等のイベント時に呼ばれるアクションを設定できる。</dd>
                    <dt><strong>「Position・Rotation・Scale」タブ</strong></dt>
                    <dd>このタブで選択している項目のアクションを、アクション追加ボタンを押すと追加される。</dd>
                    <dt><strong>書き出し対象に追加</strong></dt>
                    <dd>この設定が有効状態になっていると、書き出されるマップデータに対象のアクションデータが含まれる。</dd>
                    <dt><strong>ループ設定を有効</strong></dt>
                    <dd>この設定が有効状態になっていると、呼ばれたアクションがループされるようになる。</dd>
                    <dt><strong>フレーム最大値</strong></dt>
                    <dd>各アクションのフレーム数の最大値を設定する。</dd>
                    <dt><strong>追加・削除・全削除ボタン</strong></dt>
                    <dd>タブで設定したアクションを、追加・削除を行います。全削除だと登録したアクションを全て削除され、削除だと直近で登録したアクションが削除されます。</dd>
                    <dt><strong>アクションデータリスト</strong></dt>
                    <dd>追加したアクションはこのリストで表示される。リスト要素には、移動フレーム数・Value（移動値）がありこの項目を調整してアクションを設定する。移動フレーム数は、フレーム最大値より多くならないため0～フレーム最大値の間で移動フレーム数を設定する。</dd>
                    <dt><strong>アクションテスト機能</strong></dt>
                    <dd>Unityのゲームシーンを再生状態にすると、新たに再生ボタンが表示される。ボタンの種類は、再生・全再生・ReSetの三項目で、再生を押すとタブで対象となったアクションを再生し、全再生を押すと全て複合されたアクションが再生される、Resetを押すと初期状態に戻すことができる。</dd>
                </dl>
                </div>

                <p>
                    ここでは、アクションデータを設定することができます。アクションデータは、ゲームの開始時や終了時などの各イベント発生タイミングで呼ばれるデータです。各座標変換を経過フレームごと呼び出し動作します。各々登録した値が同時に呼ばれるため、移動と回転を登録した場合は、回転しながら移動をします。登録したイベントは、Game側でデータを登録後呼び出す事で使用できます。アクションデータをループ設定にするとアクションがループされるようになるので、これによって複雑な移動オブジェクト等を、簡単に作成する事が出来ます。また登録したアクションは、Unity上で再生することもできるので、登録したアクションがどう動くのか確かめることができます。
                </p>
            </div>
            <div class="Specification">
                <h3>②書き出し設定</h3>
                <div class="flex">
                <img src="../img/SaveDialog.png" alt="書き出し設定画像">
                <dl class ="ParamBox" id = "OutPutDialog">
                    <dt><strong>・設定</strong></dt>
                    <dd>
                        <dl>
                            <dt>エリア設定</dt>
                            <dd>書き出しエリア設定</dd>
                            <dt>ステージ設定</dt>
                            <dd>書き出しステージ設定。</dd>
                            <dt>新規作成</dt>
                            <dd>ファイルを新しく作成する。同名ファイルがある場合、上書きしてもいいかとダイアログが表示されOKを押すと上書き保存される。</dd>
                            <dt>ステージリロード設定</dt>
                            <dd>リロード設定を有効にすると、プレイヤーなどが、再復帰する際にステージを再読み込みする。無効にすると再復帰時は、再配置処理のみが呼ばれる用になる。</dd>
                        </dl>
                    </dd>
                    <dt><strong>パス情報</strong></dt>
                    <dd>この領域には、ファイル名を除く保存ファイルへのディレクトリが表示される。</dd>
                    <dt><strong>ファイル名</strong></dt>
                    <dd>パスで指定されたディレクトリの中に保存するファイル名を記述する。ファイル名は、直接打ち込むか右にあるボタンを押してファイルダイアログでファイルを参照する方法の二種類あり、状況に応じて使い分けていく必要がある。</dd>
                </dl>
                </div>

                <p>
                    ここでは、マップの書き出し設定をする事ができます。今回の制作では、ゲームマップがエリアごとに分けられていたので、エリア設定とステージ設定の項目を作成しました。各ステージを読み込む際には、ここで設定したエリアとステージを参照して対応するステージを生成します。マップの書き出しには新規作成と追記保存の二つがあり、新規作成は、新しくマップデータを作成し、追記保存は、設定したエリアとステージをマップデータから参照し、同じ物があれば上書き、なければ追加するようになっています。今回の制作では、この書き出し形式でしたが、今後の作成するゲームに応じて書き出し形式を変更していけばあらゆるゲームに対応できると思っています。
                </p>
            </div>
            <div class="Specification">
                <h3>③読込結果</h3>
                <div class = "flex" id = "ComparisonImg">
                    <img id="UnityStageImg" src="../img/UnityStage1.png" alt="Unity配置ゲームステージ">
                    <img id="RightArrow" src="../img/RightAr.png" alt="右矢印">
                    <img id ="GameStageImg" src="../img/UnityStage1.png" alt="ゲームデータ出力ステージ">
                </div>

                <!-- 説明 -->
                <p>
                    上の画像の通り、Unityで作成したマップデータを読み込む事でGame側でも同じようにマップを読み込むことができます。今回ゲームプレイに必要な設定は、全てマップ側で設定しているため、Game側では、各オブジェクトの挙動のみを記述するだけでよく全体作業工数の削減につながりました。Game側では、マップデータを参照してステージを生成しているだけなので、マップデータを外部で変更するだけでマップを変更する事ができ、マップ情報変更時における人為的なミスを防ぐことができます。
                </p>
            </div>
        </div>
    </main>
    <footer>
        <a href="index.html">目次へ</a>
    </footer>
</body>
</html>